<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/favicon16.png" type="image/png">
    <meta name="og:site_name" content="CyberYoshi64's website">
    <meta name="theme-color" content="#00C0FF" data-react-helmet="true">
    <meta name="description" content="Read info from the CYX crash dump">
    <title>PTCSysDump Viewer</title>
    <style>
        @font-face {
            font-family: std;
            src: url("/assets/fonts/CTRNTLG-DB.ttf") format("truetype");
        }
        body {
            background: #000;
            color: white;
            font-family: std, 'MS PGothic', sans-serif!important;
            font-size: 12pt;
            margin: 10vh 15vw;
        }
        code {
            font-size: 12pt;
            font-family: "Cascadia Mono", "MS Gothic", monospace!important;
        }
        table {
            border-radius: 10pt;
            background: linear-gradient(160deg, #222 0%, #000 100%);
        }

        table, td {
            overflow-x: clip;
            max-width: 70vw;
            padding: 0px;
        }

        td {
            max-width: calc(70vw - 6px);
            line-height: 1.25;
        }
        button {
            background: #0bf4;
            border: none;
            width: 100%;
            font-size: 12pt;
            padding: 3px 0px;
            border-radius: 12pt;
            color: white;
        }
        button:hover {
            background: #0ff5;
        }
        .innertd {padding: 0px 10pt;}
        .innertd2 {padding: 0px 20pt;}
        .innertd3 {padding: 0px 30pt;}
        .innertd4 {padding: 0px 40pt;}
        .tc1 {
            background: linear-gradient(160deg, #7fbfff40 0%, #3f7fff20 100%);
        }

        .tc2 {
            transition: opacity 200ms cubic-bezier(.68,-0.55,.27,1.55);
            background: linear-gradient(145deg, #ff404070 0%, #ff404030 100%);
            opacity: .6;
        }

        .tc2:hover {
            opacity: 1;
        }

        .txac {
            display: block;
            text-align: center;
            width: 100%;
            white-space: nowrap;
        }

        thead td {
            border-radius: 9pt 9pt 0px 0px;
            height: 28pt;
        }

        tfoot td {
            border-radius: 0px 0px 9pt 9pt;
            height: 28pt;
        }

        input {
            position: absolute;
            opacity: 0;
            width: calc(70vw - 6px);
            height: 28pt;
            transform: translate(0px, -6px);
        }
        a {
            background: #0080ff40;
            border-radius: 4px;
            padding: 0px 3px;
            text-decoration: none;
            color: aqua;
        }
        hr {
            border: 0;
            background: linear-gradient(90deg, #fff0 0%, #ffff 50%, #fff0 100%);
            height: 4px;
            border-radius: 100%;
        }

        span.plgflgboxtc {
            vertical-align: middle;
        }
        span.plgflgbox {
            display: inline-table;
            border-radius: 4pt;
            background: linear-gradient(135deg, #fff2 0%, #fff0 100%);
            color: #ccc;
            text-align: center;
            width: 20pt;
            height: 20pt;
            font-size: 10pt;
            user-select: none;
            margin: 2pt;
        }
        .plgflgsev0 {
            background: linear-gradient(135deg, #0f05 0%, #0f01 100%)!important;
            color: #4c4!important;
        }
        .plgflgsev1 {
            background: linear-gradient(135deg, #0cf5 0%, #07f2 100%)!important;
            color: cyan!important;
        }
        .plgflgsev2 {
            background: linear-gradient(135deg, #ff04 0%, #f802 100%)!important;
            color: yellow!important;
        }
        .plgflgsev3 {
            background: linear-gradient(135deg, #f804 0%, #f002 100%)!important;
            color: #f80!important;
        }
        .plgflgsev4 {
            background: linear-gradient(135deg, #f044 0%, #f042 100%)!important;
            color: #f04!important;
        }
        .note {color: #0ffa; font-size: 9.5pt;}
        .warn {color: #fc0c; font-size: 9.5pt;}

        @media only screen and (min-width: 1150px){
            input {
                width: 794px;
            }
            table, td {
                max-width: 800px;
            }

            td {
                max-width: 794px;
            }
            body {
                margin: 15vh calc(50vw - 400px);
            }
        }
        @media only screen and (min-width: 1920px){
            input {
                width: 1194px;
            }
            table, td {
                max-width: 1200px;
            }

            td {
                max-width: 1194px;
            }
            body {
                margin: 15vh calc(50vw - 600px);
                font-size: 18pt;
            }
            thead td, tfoot td, input {
                height: 42pt;
            }
            thead td {
                border-radius: 16pt 16pt 0px 0px;
            }

            tfoot td {
                border-radius: 0px 0px 16pt 16pt;
            }
            table {
                border-radius: 17pt;
            }
            span.plgflgbox {
                border-radius: 8pt;
                width: 30pt;
                height: 30pt;
                font-size: 15pt;
                margin: 4pt;
            }
            a {
                border-radius: 10pt;
                padding: 0pt 8pt;
            }
            .note {font-size: 14pt;}
            .warn {font-size: 14pt;}
        }
        @media only screen and (max-width: 640px){
            input {
                width: calc(96vw - 6px);
            }
            table, td {
                max-width: 96vw;
            }

            td {
                max-width: calc(96vw - 6px);
            }
            body {
                margin: 5vh 2vw;
            }
        }
    </style>
</head>

<body>
    <table width="100%" style="background-color: #111;" id="tab">
        <thead>
            <td class="tc1">
                <input type="file" id="fileIn" onchange="loadit()">
                <span class="txac" id="fileName"></span>
            </td>
        </thead>
    </table>
    <a id="dl" style="display:none;">Download</a>
</body>
<script>
var reader = new FileReader;
var fname = document.getElementById("fileName")
var table = document.getElementById("tab")
var cyxDump = {}
clearTable()
function cyxrescue__newDumpStruct(){
    return {
        nodeCount: 0,
         0: {name: "", bufSize: 0, dataLen: 0, offset: 0},
         1: {name: "", bufSize: 0, dataLen: 0, offset: 0},
         2: {name: "", bufSize: 0, dataLen: 0, offset: 0},
         3: {name: "", bufSize: 0, dataLen: 0, offset: 0},
         4: {name: "", bufSize: 0, dataLen: 0, offset: 0},
         5: {name: "", bufSize: 0, dataLen: 0, offset: 0},
         6: {name: "", bufSize: 0, dataLen: 0, offset: 0},
         7: {name: "", bufSize: 0, dataLen: 0, offset: 0},
         8: {name: "", bufSize: 0, dataLen: 0, offset: 0},
         9: {name: "", bufSize: 0, dataLen: 0, offset: 0},
        10: {name: "", bufSize: 0, dataLen: 0, offset: 0},
        11: {name: "", bufSize: 0, dataLen: 0, offset: 0},
        12: {name: "", bufSize: 0, dataLen: 0, offset: 0},
        13: {name: "", bufSize: 0, dataLen: 0, offset: 0},
        14: {name: "", bufSize: 0, dataLen: 0, offset: 0},
        15: {name: "", bufSize: 0, dataLen: 0, offset: 0},
    }
}
function cyxrescue__contentType(t=0){
    var aTypes=[
        "PRG",
        "CLIP",
        "GRP"
    ]
    var str = "", sep = " + "
    for (var i=0; i<aTypes.length; i++){
        if (t & (1<<i)){
            str += aTypes[i]+sep
        }
    }
    if (str.endsWith(sep)){
        return str.substr(0,str.length - sep.length)
    }
    return str
}
function addCYXRescueLines(){
    if (cyxDump.nodeCount < 1) return
    for (var i=0; i<cyxDump.nodeCount; i++){
        var dispName = cyxDump[i].name, a = dispName.search("-")
        if (a>0) dispName = dispName.substr(0,a)
        addLine((i+1)+": "+dispName, ["innertd2"])
        if (a>0) {
            dispName = cyxDump[i].name.substr(a+1)
            if (dispName!="") addLine("Name: "+dispName, ["innertd3", "note"])
        } else if (dispName.substr(0,3)=="PRG") {
            addLine("Unnamed Program Slot", ["innertd3", "note"])
        } else if (dispName.substr(0,3)=="CLP") {
            addLine("Clipboard Data", ["innertd3", "note"])
        } else if (dispName.substr(0,3)=="GRP") {
            addLine("Graphic Page", ["innertd3", "note"])
        }
        addLine("Save as:", ["innertd3"])
        if (cyxDump[i].dataLen > 0){
            addLineH('<button title="The typical option. Converts the data back into a SmileBASIC file." onclick="cyxrescue__save_conv('+i+')">SmileBASIC</button>', ["innertd4"])
            addLineH('<button title="Extracts the raw data from the CYX dump." onclick="cyxrescue__save_raw('+i+')">Raw binary</button>', ["innertd4"])
        } else {
            addLine("The data is reported to be 0 bytes. Maybe you can rescue some data in the whole buffer instead.", ["innertd4","warn"])
        }
        if (cyxDump[i].dataLen != cyxDump[i].bufSize){
            addLineH('<button title="Converts the entire data buffer back into a SmileBASIC file. This option is to try save leftover data from previous programs or clipboard contents." onclick="cyxrescue__save_convf('+i+')">SmileBASIC (entire buffer)</button>', ["innertd4"])
            addLineH('<button title="Extracts the entire data buffer in raw format." onclick="cyxrescue__save_rawf('+i+')">Raw binary (entire buffer)</button>', ["innertd4"])
        } else {
            addLine("The data is the same size as its given buffer size.", ["innertd4","note"])
        }
        addLineH("<br>")
    }
}
/**
 * Craft a GRP file with the contents provided in the CYX dump
 * 
 * cyxidx    - CYX Dump index of the file to save
 * isfullbuf - Whether to take only the reported length or the entire buffer
*/
function saveGRP(cyxidx=-1, isfullbuf=false){
    if (cyxidx < 0) return
    var arr = hextoarray("01000100000002001C0008000000000000000000506C73206F76657277726974652100000000506C73206F766572777269746521000000000000000000000000000000000000000000000000000000005043424E303030310300020000020000000200000000000000000000")
    var arr2 = new Uint8Array(524288)
    var off = cyxDump[cyxidx].offset
    var len = 0

    /*
        SmileBASIC stores the raw GRP 90° CCW and swizzled
        This below loop looks weird but it works™️
    */

    for (var y=511; y>=0; y--){
        for (var x=0; x<512; x++){
            pxoff = Math.trunc(((((x >> 3) * (512 >> 3) + (y >> 3)) << 6) + ((y & 1) | ((x & 1) << 1) | ((y & 2) << 1) | ((x & 2) << 2) | ((y & 4) << 2) | ((x & 4) << 3))) * 2)
            arr2[len] = file[off+pxoff]
            arr2[len+1] = file[off+pxoff+1]
            len += 2
        }
    }
    var arr3 = hextoarray("5468697320666F6F746572206973207761636B2E")

    off = arr.length

    var out = new Uint8Array(off + 524288 + arr3.length)
    out.set(arr, 0)
    out.set(arr2, off)
    out.set(arr3, off+524288)
    downloadfile(out, "B"+cyxDump[cyxidx].name.substr(0,14))
}
function ucs2toutf8(b=0,b2=0){
    var a = new Uint8Array(4)
    if (b <= 0x7f){
        a[0] = b
        return a.slice(0,1)
    } else if (b <= 0x7ff) {
        a[0]=(0xC0 | (b>>6 & 0x1F))
        a[1]=(0x80 | (b & 0x3F))
        return a.slice(0,2)
    } else {
        if (0xD800<=b && b<=0xD8FF && 0xDC00<=b2 && b2<=0xDFFF){
            var c = 0x10000 + ((b & 0x3FF)<<10) + (b2 & 0x3FF)
            a[0] = 0xF0 | ((c>>18)&0x07)
            a[1] = 0x80 | ((c>>12)&0x3F)
            a[2] = 0x80 | ((c>>6)&0x3F)
            a[3] = 0x80 | (c&0x3F)
            return a
        }
        a[0] = 0xE0 | ((b>>12)&0x0F)
        a[1] = 0x80 | ((b>>6)&0x3F)
        a[2] = 0x80 | (b&0x3F)
        return a.slice(0,3)
    }
    return a
}
function saveTxt(cyxidx=-1, isfullbuf=false){
    var arr = hextoarray("0100000000000000000000000000000000000000506C73206F76657277726974652100000000506C73206F76657277726974652100000000000000000000000000000000000000000000000000000000")
    var off = cyxDump[cyxidx].offset
    var len = 0
    if (isfullbuf)
        len = cyxDump[cyxidx].bufSize
    else
        len = cyxDump[cyxidx].dataLen
    var arr2 = new Uint8Array(len*2+1)
    var off2 = 0
    while (len > 1){
        var arr3 = ucs2toutf8(readnum(off, off+1),readnum(off+2, off+3))
        for (var i=0; i<arr3.length; i++)
            arr2[off2+i] = arr3[i]
        off2 += arr3.length
        if (arr3.length == 4) {
            len-=2; off+=2
        }
        len-=2; off+=2
    }
    arr2[off2]=0xa
    var arr3 = hextoarray("5468697320666F6F746572206973207761636B2E")

    off = arr.length

    var out = new Uint8Array(off + off2 + arr3.length)
    out.set(arr, 0)
    out.set(arr2.slice(0,off2), off)
    out.set(arr3, off+off2)

    downloadfile(out, "T"+cyxDump[cyxidx].name)
}
function cyxrescue__save_conv(index=-1){
    if (index<0) return
    var filename = cyxDump[index].name.substr(0,3)
    if (filename != "GRP")
        saveTxt(index, false)
    else
        saveGRP(index, false)
}
function cyxrescue__save_convf(index=-1){
    if (index<0) return
    var filename = cyxDump[index].name.substr(0,3)
    if (filename != "GRP")
        saveTxt(index, true)
    else
        saveGRP(index, true)
}
function cyxrescue__save_raw(index=-1){
    if (index<0) return
    downloadfile(file.slice(cyxDump[index].offset, cyxDump[index].offset+cyxDump[index].dataLen), "CYX-"+cyxDump[index].name+".bin")
}
function cyxrescue__save_rawf(index=-1){
    if (index<0) return
    downloadfile(file.slice(cyxDump[index].offset, cyxDump[index].offset+cyxDump[index].bufSize), "CYX-"+cyxDump[index].name+"-full.bin")
}
function loadit() {
    reader.readAsArrayBuffer(fileIn.files[0]);
    reader.onload = function () {
        var arraybuff = reader.result;
        clearEnv()
        file = new Uint8Array(arraybuff);
        var filename = document.getElementById("fileIn").value;
        var n = "";
        while (filename.length > 0 && filename.substring(filename.length - 1, filename.length) != "/" && filename.substring(filename.length - 1, filename.length) != "\\") {
            n = filename.substring(filename.length - 1, filename.length) + n;
            filename = filename.substring(0, filename.length - 1);
        }
        fname.innerText = n
        load();
    }
}
function clearEnv(){
    clearTable()
    cyxDump = {}
    file = {}
}
function addLine(text,classes=["innertd"]) {
    var tr = document.createElement("tr")
    var td = document.createElement("td")
    for (i=0; i<classes.length; i++){
        td.classList.add(classes[i])
    }
    var span = document.createElement("span")
    span.style = "white-space: normal; overflow-x: auto;"
    span.innerText = text
    td.appendChild(span)
    tr.appendChild(td)
    table.appendChild(tr)
}
function addLineH(text,classes=["innertd"]) {
    var tr = document.createElement("tr")
    var td = document.createElement("td")
    for (i=0; i<classes.length; i++){
        td.classList.add(classes[i])
    }
    var span = document.createElement("span")
    span.style = "white-space: normal; overflow-x: auto;"
    span.innerHTML = text
    td.appendChild(span)
    tr.appendChild(td)
    table.appendChild(tr)
}
function endLine(text) {
    var tr = document.createElement("tfoot")
    var td = document.createElement("td")
    td.classList.add("tc2")
    var sp = document.createElement("span")
    sp.classList.add("txac")
    sp.innerText = text
    td.onclick = clearEnv
    td.appendChild(sp)
    tr.appendChild(td)
    table.appendChild(tr)
}
function clearTable() {
    while (table.children.length > 1)
        table.removeChild(table.children[1])
    fname.innerText = "Click here to upload a file"
}
function load() {
    addLineH("<br>")
    if (readstring(0,7)=="CYX$DMP0"){
        cyxDump = cyxrescue__newDumpStruct()
        var version = readnum(8,11)
        var type = readnum(12,13)
        cyxDump.nodeCount = readnum(14,15)
        var off = 16
        for(var i=0; i<16; i++){
            cyxDump[i].name = readstring(off,off+23)
            off += 24
        }
        for(var i=0; i<16; i++){
            cyxDump[i].bufSize = readnum(off,off+3)
            off += 4
        }
        for(var i=0; i<16; i++){
            cyxDump[i].dataLen = readnum(off,off+3)
            off += 4
        }
        off = 640
        for(var i=0; i<16; i++){
            cyxDump[i].offset = off
            off += cyxDump[i].bufSize
        }
        if (off > file.length){
            addLine("An error has occured:",["innertd2","warn"])
            addLine("The header signifies the data to be out of bounds.",["innertd2","warn"])
            addLine("Cannot rescue the data.",["innertd2","warn"])
        } else if (cyxDump.nodeCount < 1 || cyxDump.nodeCount > 16) {
            addLine("An error has occured:",["innertd2","warn"])
            addLine("THe node count is out of bounds.",["innertd2","warn"])
            addLine("Cannot rescue the data.",["innertd2","warn"])
        } else {
            addLine("Version: "+version)
            addLine("Content type: "+cyxrescue__contentType(type))
            addLine("File count: "+cyxDump.nodeCount)
            addLineH("<br>Warning:<br>These downloads for the SmileBASIC files are not being verified and thus have to be manually verified by loading the files in SmileBASIC and saving/overwriting them.<br>&nbsp;",["innertd2","warn"])
            addCYXRescueLines()
        }
    } else if (readstring(0,3)!="CY5%"){
        addLine("This is not a crash dump.")
    } else {
        var version = readnum(4,5); // u16
        var type = readnum(6,6); // u8
        var lang = readnum(7,7); // u8
        var ptcverOrig = readnum(8,11); // u32
        var plgVer = readnum(12,15); // u32
        var plgFlg = readnum(16,19); // u32

        addLine("Version: "+(version & 0x3FFF))
        addLine("Type: "+excepType(type))
        addLine("Language: "+parseLang(lang))
        addLine("Flags:")
        addPluginFlags(plgFlg)
        addLine("Plugin version: "+ptcver(plgVer))
        addLine("SB3 version: "+ptcver(ptcverOrig, lang))

        if (version & 0x8000) {
            // Is not a panic
            var pc = readnum(20,23); // u32
            var lr = readnum(24,27); // u32
            var sp = readnum(28,31); // u32
            var far = readnum(32,35); // u32
            var callStackLen = 6; // u32 * 6
            addLine("Program names:")
            for (var i=0; i<4; i++){
                var s = readstring(60+i*15,74+i*15)
                if (s!="")
                    addLineH(i+": <code>"+s+"</code>",["innertd2"])
                else
                    addLineH(i+": <span class=warn>None</span>",["innertd2"])
            }
            addLine("Registers:")
            addLineH("PC: <code>"+hex(pc,8)+"</code>",["innertd2"])
            addLineH("LR: <code>"+hex(lr,8)+"</code>",["innertd2"])
            addLineH("SP: <code>"+hex(sp,8)+"</code>",["innertd2"])
            addLineH("FAR: <code>"+hex(far,8)+"</code>",["innertd2"])
            addLine("Call Stack:")
            for (var i=0; i<callStackLen; i++)
                addLineH(i+": <code>"+hex(readnum(36+i*4,39+i*4),8)+"</code>",["innertd2"])
        } else {
            // Is a panic, returns a string
            var err = readstring(20,119).trim(); // string[100]
            addLineH("<hr>")
            addLine("Error message:")
            if (err!="")
                addLineH("<code>"+err+"</code>",["innertd2"])
            else 
                addLineH("<span class=\"warn\">Looks like the error string has been truncated.<br>The crash dump may have been modified. Take these results with a grain of salt!</span>",["innertd2"])
        }
    }
    addLineH("<br>")
    endLine("Close")
}
function hex(n=0,d=2){
    return "0x"+string_rjust(n.toString(16).toUpperCase(),d,0)
}
function addPluginFlags(f=0){
    var aFlags = {
         0: ["P", 4, "The plugin has panicked."],
         1: ["-", 9, ""],
         2: ["-", 9, ""],
         3: ["-", 9, ""],
         4: ["-", 9, ""],
         5: ["-", 9, ""],
         6: ["-", 9, ""],
         7: ["-", 9, ""],
         8: ["-", 9, ""],
         9: ["-", 9, ""],
        10: ["-", 9, ""],
        11: ["-", 9, ""],
        12: ["-", 9, ""],
        13: ["-", 9, ""],
        14: ["-", 9, ""],
        15: ["-", 9, ""],
        16: ["-", 9, ""],
        17: ["-", 9, ""],
        18: ["-", 9, ""],
        19: ["-", 9, ""],
        20: ["-", 9, ""],
        21: ["-", 9, ""],
        22: ["-", 9, ""],
        23: ["S", 0, "The user changed the server addresses (likely for SBServer). This by itself is safe and shouldn't cause issues."],
        24: ["X", 3, "The user enabled the CYX API, which is currently experimental and may have caused the crash."],
        25: ["-", 9, ""],
        26: ["-", 9, ""],
        27: ["-", 9, ""],
        28: ["-", 9, ""],
        29: ["-", 9, ""],
        30: ["v", 2, "The user spoofed the SmileBASIC version."],
        31: ["E", 3, "The user has run an experiment. This may have caused the crash."]
    }
    if (f == 0){
        var __tr = document.createElement("tr")
        var __td = document.createElement("td")
        __td.classList.add("innertd2")
        var _sp = document.createElement("span")
        _sp.classList.add("note")
        _sp.innerText="No flags were set."
        __td.appendChild(_sp)
        __tr.appendChild(__td)
        table.appendChild(__tr)
    }
    var __tr = document.createElement("tr")
    var __td = document.createElement("td")
    __td.classList.add("innertd2")
    for (var i=31; i>=0; i--){
        if (f & (1<<i)){
            var _sp = document.createElement("span")
            _sp.classList.add("plgflgbox")
            _sp.classList.add("plgflgsev"+aFlags[i][1])
            var _sptext = document.createElement("span")
            _sptext.classList.add("plgflgboxtc")
            _sptext.innerText = aFlags[i][0]
            _sp.appendChild(_sptext)
            if (aFlags[i][2]==""){
                _sp.title = "This flag is either not known or the crash dump was modified. Take the results with a grain of salt!"
            } else {
                _sp.title = aFlags[i][2]
            }
            __td.appendChild(_sp)
        }
    }
    __tr.appendChild(__td)
    table.appendChild(__tr)
}
function excepType(type=0){
    var aTypes = [
        "Prefetch Abort",
        "Data Abort",
        "Undefined Instruction",
        "Floating Point Exception"
    ]
    if (type >= aTypes.length) return "Plugin Panic"
    return aTypes[type]
}
function parseLang(lang=0){
    var s=""
    var tLng = [
        "Japanese",
        "English",
        "French",
        "German",
        "Italian",
        "Spanish",
        "Simplified Chinese",
        "Korean",
        "Dutch",
        "Portuguese",
        "Russian",
        "Traditional Chinese"
    ]
    var language = lang & 15
    if (language > tLng.length)
        return "["+language+"]"
    return tLng[language]
}
function ptcver(num=0, lng=-1){
    var s = ""
    if (lng>=0){
        var lng = (lng >> 4)&15
        var tReg = ["[BAD] ","JPN ","USA ","EUR "]
        if (lng >= tReg.length)
            s += "UNK "
        else
            s += tReg[lng]
    }
    s +=
        ((num>>24)&255)+"."+
        ((num>>16)&255)+"."+
        ((num>> 8)&255)
    if (num & 255) s += "-"+(num & 255)
    return s
}
function downloadfile(file,n){
	var z = new Blob([file], {"type":"octet/stream"});
	document.getElementById("dl").href=URL.createObjectURL(z);
	document.getElementById("dl").download=n;
	if(!!navigator.msSaveBlob){
		navigator.msSaveBlob(z, n);
		return;
	}
	document.getElementById("dl").click();
}
function string_rjust(s, l=0, p=" "){
    while (s.length < l)
        s = p+s
    return s
}
function hexs(st){
	return "0123456789ABCDEF".indexOf(st);
}
function hextoarray(s){
    var arr = new Uint8Array(s.length/2)
	for(var i=0;i<(s.length-1)/2;i++){
		arr[i] = hexs(s[i*2])<<4 | hexs(s[i*2+1]);
	}
    return arr
}
function readnum(start,end){
	var number=0;
	for(var i=start;i<=end;i++){
		number+=Math.pow(256,(i-start))*file[i];
	}
	return number;
}
function insertnum(num,length,pos){
	for(var i=0;i<length;i++){
		file[i+pos]=(num & 255);
		num=(num-(num & 255))/256;
	}
}
function readstring(start,end){
	var stri="";
	for(var i=start;i<=end;i++){
		if(file[i]!=0)
            stri=stri+String.fromCharCode(file[i]);
        else
            break
	}
	return stri;
}
</script>

</html>